<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>All Time Teams</title>
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
<style>
  body {
    background-color: #71A95A; /* Green like Wrigley Field grass */
    font-family: Arial, sans-serif;
  }
  .container {
    margin-top: 20px;
    background-color: #FAFAD2; /* Sand color */
    padding: 20px;
    border-radius: 10px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
    background-color: #FAFAD2; /* Sand color */
  }
  th, td {
    border: 1px solid #dddddd;
    text-align: left;
    padding: 8px;
  }
  th {
    background-color: #f2f2f2; /* Light gray header */
  }
  .stat-square {
    width: 30px;
    height: 30px;
    background-color: #ffffff; /* White square */
    border: 1px solid #dddddd;
  }
</style>
</head>
<body>

<div class="container">
  <h2>All Time Teams</h2>
  <table class="table table-bordered">
    <thead>
      <tr>
        <th id="teamLabel"></th>
        <th>Position</th>
        <th id="statLabel">Stat</th> <!-- New column for Stat -->
        <th>Submit Player</th> <!-- New column for submit button -->
      </tr>
    </thead>
    <tbody id="playerRows">
      <!-- Table rows will be generated dynamically -->
    </tbody>
  </table>

  <!-- Total Score -->
  <div>
    <p>Total Score: <span id="totalScore"></span></p>
  </div>
</div>

<script>
function updateLabels() {
  var teams = [
    "Arizona Diamondbacks", "Atlanta Braves", "Baltimore Orioles", "Boston Red Sox",
    "Chicago White Sox", "Chicago Cubs", "Cincinnati Reds", "Cleveland Guardians",
    "Colorado Rockies", "Detroit Tigers", "Houston Astros", "Kansas City Royals",
    "Los Angeles Angels of Anaheim", "Los Angeles Dodgers", "Miami Marlins", "Milwaukee Brewers",
    "Minnesota Twins", "New York Yankees", "New York Mets", "Oakland Athletics",
    "Philadelphia Phillies", "Pittsburgh Pirates", "San Diego Padres", "San Francisco Giants",
    "Seattle Mariners", "St. Louis Cardinals", "Tampa Bay Rays", "Texas Rangers",
    "Toronto Blue Jays", "Washington Nationals"
  ];
  var randomTeamIndex = Math.floor(Math.random() * teams.length);
  var randomTeam = teams[randomTeamIndex];
  document.getElementById('teamLabel').innerText = randomTeam;

  var stats = ["r", "h", "2b", "3b", "hr", "rbi", "sb", "bb", "ibb"];
  var randomStatIndex = Math.floor(Math.random() * stats.length);
  var randomStat = stats[randomStatIndex];
  document.getElementById('statLabel').innerText = randomStat;
}

function handleSubmit(event) {
  var submitButton = event.target;
  if (submitButton.disabled) return; // Check if the button is already disabled
  submitButton.disabled = true; // Disable the button to prevent multiple submissions

  var playerNameInput = submitButton.parentElement.parentElement.children[0].children[0];
  var playerName = playerNameInput.value.trim(); // Trim whitespace
  if (playerName !== '') {
    var position = submitButton.parentElement.parentElement.children[1].textContent;
    var team = document.getElementById('teamLabel').textContent;
    var stat = document.getElementById('statLabel').textContent; // Retrieve the value of the stats label

    // Fetch data for the submitted player
    var xhr = new XMLHttpRequest();
    xhr.open('GET', 'http://localhost:3000/search?playerName=' + playerName + '&position=' + position + '&team=' + team + '&stat=' + stat, true);
    xhr.onload = function () {
      if (xhr.status === 200) {
        var statSquare = submitButton.parentElement.parentElement.children[2].children[0];
        var statValue = xhr.responseText;
        statSquare.textContent = (statValue === '0') ? '0' : statValue; // Display '0' if no data found
        updateTotalScore(); // Update total score after each submission
      } else {
        console.error('Error fetching data:', xhr.statusText);
      }
    };
    xhr.onerror = function () {
      console.error('Error fetching data.');
    };
    xhr.send();
  }
}

function addPlayerRows() {
  var positions = ["C", "1B", "2B", "3B", "SS", "OF", "OF", "OF", "P"];
  var tbody = document.getElementById("playerRows");
  for (var i = 0; i < 9; i++) {
    var row = document.createElement("tr");
    
    var playerNameCell = document.createElement("td");
    var playerNameInput = document.createElement("input");
    playerNameInput.type = "text";
    playerNameInput.className = "form-control player-input";
    playerNameInput.placeholder = "Enter player's name";
    playerNameCell.appendChild(playerNameInput);
    row.appendChild(playerNameCell);
    
    var positionCell = document.createElement("td");
    positionCell.textContent = positions[i];
    row.appendChild(positionCell);
    
    var statCell = document.createElement("td");
    var statSquare = document.createElement("div");
    statSquare.className = "stat-square";
    statCell.appendChild(statSquare);
    row.appendChild(statCell);
    
    var submitCell = document.createElement("td");
    var submitButton = document.createElement("button");
    submitButton.type = "button";
    submitButton.className = "btn btn-primary";
    submitButton.textContent = "Submit";
    submitButton.addEventListener('click', handleSubmit);
    submitCell.appendChild(submitButton);
    row.appendChild(submitCell);
    
    tbody.appendChild(row);
    
    if (positions[i] === 'P') {
      break; // Stop adding rows when reaching 'P' position
    }
  }
}

function updateTotalScore() {
  var statSquares = document.querySelectorAll('.stat-square');
  var totalScore = 0;
  statSquares.forEach(function(statSquare) {
    var statValue = parseInt(statSquare.textContent);const express = require('express');
const mysql = require('mysql2');
const cors = require('cors');

const app = express();

app.use(cors());

const connection = mysql.createConnection({
  host: 'DESKTOP-P6I7QLQ',
  user: 'root',
  password: '1102',
  database: 'lahmansbaseballdb'
});

connection.connect((err) => {
  if (err) {
    console.error('Error connecting to MySQL:', err);
    return;
  }
  console.log('Connected to MySQL database');
});

// Search endpoint to fetch player stats
app.get('/search', (req, res) => {
  const playerName = req.query.playerName;
  const position = req.query.position;
  const team = req.query.team;
  const stat = req.query.stat; // Add stat parameter

  // MySQL query to fetch player stats
  const query = `
    SELECT MAX(b.${stat}) AS max_stat_value
    FROM batting AS b
    JOIN people AS p ON b.playerID = p.playerID
    JOIN fielding AS f ON b.playerID = f.playerID
    JOIN teams AS t ON b.teamID = t.teamID
    WHERE CONCAT(p.nameFirst, ' ', p.nameLast) = ? 
      AND f.POS = ?
      AND t.franchID IN (
        SELECT franchID
        FROM teams
        WHERE name = ?
      )
  `;

  connection.query(query, [playerName, position, team], (error, results) => {
    if (error) {
      console.error('Error executing MySQL query:', error);
      res.status(500).send('Internal server error');
    } else {
      if (results.length > 0 && results[0].max_stat_value !== null) {
        const maxStatValue = results[0].max_stat_value;
        res.send(maxStatValue.toString());
      } else {
        console.log('No results found for the query');
        res.send('0'); // Return '0' if no records found or max_stat_value is null
      }
    }
  });
});

// Autocomplete endpoint to fetch player name suggestions
app.get('/autocomplete', (req, res) => {
  const query = req.query.query; // Get the query parameter from the request

  // MySQL query to fetch player name suggestions based on the input query
  const autocompleteQuery = `
    SELECT nameGiven
    FROM people
    WHERE nameGiven LIKE ?
    LIMIT 10
  `;

  connection.query(autocompleteQuery, [`%${query}%`], (error, results) => {
    if (error) {
      console.error('Error executing autocomplete MySQL query:', error);
      res.status(500).send('Internal server error');
    } else {
      const suggestions = results.map((row) => row.nameGiven);
      res.json(suggestions);
    }
  });
});

// Server listening on port 3000
const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
  console.log(`Server running on port ${PORT}`);
});

    if (!isNaN(statValue)) {
      totalScore += statValue;
    }
  });
  document.getElementById('totalScore').textContent = totalScore;
}

window.onload = function() {
  updateLabels();
  addPlayerRows();
};
</script>

</body>
</html>
