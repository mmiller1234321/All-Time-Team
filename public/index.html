<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>All Time Teams</title>
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
<style>
  body {
    background-color: #71A95A; /* Green like Wrigley Field grass */
    font-family: Arial, sans-serif;
  }
  .container {
    margin-top: 20px;
    background-color: #FAFAD2; /* Sand color */
    padding: 20px;
    border-radius: 10px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
    background-color: #FAFAD2; /* Sand color */
  }
  th, td {
    border: 1px solid #dddddd;
    text-align: left;
    padding: 8px;
  }
  th {
    background-color: #f2f2f2; /* Light gray header */
  }
  .stat-square {
    width: 30px;
    height: 30px;
    background-color: #ffffff; /* White square */
    border: 1px solid #dddddd;
  }
</style>
</head>
<body>

<div class="container">
  <div class="d-flex justify-content-between align-items-center">
    <h2>All Time Teams</h2>
    <button type="button" class="btn btn-primary" id="instructionsButton">Instructions</button>
  </div>
  <table class="table table-bordered">
    <thead>
      <tr>
        <th id="teamLabel"></th>
        <th>Position</th>
        <th id="statLabel">Stat</th> <!-- New column for Stat -->
        <th>Submit Player</th> <!-- New column for submit button -->
      </tr>
    </thead>
    <tbody id="playerRows">
      <!-- Table rows will be generated dynamically -->
    </tbody>
  </table>

  <!-- Total Score -->
  <div>
    <p>Total Score: <span id="totalScore"></span></p>
  </div>
</div>

<!-- Instructions Modal -->
<div class="modal fade" id="instructionsModal" tabindex="-1" role="dialog" aria-labelledby="instructionsModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="instructionsModalLabel">Instructions</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>Build an All Time Team! Choose a player who played for the given team and position. The score will be that player's highest season stat total for that category. Your total score is the sum of all the players' scores. Have fun!</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div> 
    </div>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>
// Array to keep track of submitted player names
var submittedPlayers = [];

// Function to fetch team and stat pair from the server
function fetchTeamStatPair() {
  // Dynamically determine the base URL
  var baseUrl = window.location.protocol + '//' + window.location.hostname;
  fetch(baseUrl + '/generateTeamStatPair')
    .then(response => response.json())
    .then(data => {
      updateLabels(data.team, data.stat);
    })
    .catch(error => {
      console.error('Error fetching team and stat pair:', error);
    });
}

// Function to update labels with fetched team and stat pair
function updateLabels(team, stat) {
  document.getElementById('teamLabel').innerText = team;
  document.getElementById('statLabel').innerText = stat;
}

// Function to handle form submission
function handleSubmit(event) {
  var submitButton = event.target;
  if (submitButton.disabled) return; // Check if the button is already disabled
  submitButton.disabled = true; // Disable the button to prevent multiple submissions

  // Your form submission logic goes here...
}

// Function to add player rows dynamically
function addPlayerRows() {
  var positions = ["C", "1B", "2B", "3B", "SS", "OF", "OF", "OF", "P"];
  var tbody = document.getElementById("playerRows");
  for (var i = 0; i < 9; i++) {
    var row = document.createElement("tr");
    
    var playerNameCell = document.createElement("td");
    var playerNameInput = document.createElement("input");
    playerNameInput.type = "text";
    playerNameInput.className = "form-control player-input";
    playerNameInput.placeholder = "Enter player's name";
    playerNameCell.appendChild(playerNameInput);
    row.appendChild(playerNameCell);
    
    var positionCell = document.createElement("td");
    positionCell.textContent = positions[i];
    row.appendChild(positionCell);
    
    var statCell = document.createElement("td");
    var statSquare = document.createElement("div");
    statSquare.className = "stat-square";
    statCell.appendChild(statSquare);
    row.appendChild(statCell);
    
    var submitCell = document.createElement("td");
    var submitButton = document.createElement("button");
    submitButton.type = "button";
    submitButton.className = "btn btn-primary";
    submitButton.textContent = "Submit";
    submitButton.addEventListener('click', handleSubmit);
    submitCell.appendChild(submitButton);
    row.appendChild(submitCell);
    
    tbody.appendChild(row);
    
    if (positions[i] === 'P') {
      break; // Stop adding rows when reaching 'P' position
    }
  }
}

// Function to update total score
function updateTotalScore() {
  var statSquares = document.querySelectorAll('.stat-square');
  var totalScore = 0;
  statSquares.forEach(function(statSquare) {
    var statValue = parseInt(statSquare.textContent);
    if (!isNaN(statValue)) {
      totalScore += statValue;
    }
  });
  document.getElementById('totalScore').textContent = totalScore;
}

// Function to trigger the modal when the instructions button is clicked
function triggerInstructionsModal() {
  $('#instructionsModal').modal('show');
}

// Event listener for the instructions button
document.getElementById('instructionsButton').addEventListener('click', triggerInstructionsModal);

// Window onload event
window.onload = function() {
  fetchTeamStatPair(); // Fetch initial team and stat pair
  addPlayerRows(); // Add player rows dynamically
};
</script>

</body>
</html>

